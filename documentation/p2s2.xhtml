<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>com.io7m.jtensors 9.0.0 Documentation: 2.2. Matrices</title><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8"/><link rel="stylesheet" type="text/css" href="kstructural-layout.css"/><link rel="stylesheet" type="text/css" href="kstructural-colour.css"/><link rel="stylesheet" type="text/css" href="documentation.css"/></head><body><div class="st300_body"><div class="st300_navbar st300_navbar_top"><table class="st300_navbar_table" summary="st300_Navigation bar"><tr><td class="st300_navbar_prev_title_cell">2.1. Vectors</td><td class="st300_navbar_up_title_cell">2. Conventions</td><td class="st300_navbar_next_title_cell">2.3. Quaternions</td></tr><tr><td class="st300_navbar_prev_file_cell"><a rel="previous" href="p2s1.xhtml#st300_p2s1" title="Go to previous page">Previous</a></td><td class="st300_navbar_up_file_cell"><a rel="up" href="p2.xhtml#st300_p2" title="Go to parent page">Up</a></td><td class="st300_navbar_next_file_cell"><a rel="next" href="p2s3.xhtml#st300_p2s3" title="Go to next page">Next</a></td></tr></table><hr class="st300_hr"/></div><div class="st300_section_container"><a id="conventions.matrices"/><div class="st300_section_title_number"><a id="st300_p2s2" href="#st300_p2s2" title="Section 2.2: Matrices">2.2</a></div><div class="st300_section_title">Matrices</div><ul class="st300_contents st300_section_contents_outer st300_section_contents"><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p2s2.xhtml#st300_p2s2ss1" title="Link to subsection 2.2.1: Computation Types">2.2.1. Computation Types</a></li><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p2s2.xhtml#st300_p2s2ss2" title="Link to subsection 2.2.2: Storage Types">2.2.2. Storage Types</a></li><li class="st300_contents_item st300_contents_item1 st300_contents_item_subsection"><a href="p2s2.xhtml#st300_p2s2ss3" title="Link to subsection 2.2.3: Phantom Types">2.2.3. Phantom Types</a></li></ul><div class="st300_subsection_container"><a id="conventions.matrices.computation_types"/><div class="st300_subsection_title_number"><a id="st300_p2s2ss1" href="#st300_p2s2ss1" title="Subsection 2.2.1: Computation Types">2.2.1</a></div><div class="st300_subsection_title">Computation Types</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss1c1" href="#st300_p2s2ss1c1" title="Paragraph 2.2.1.1">1</a></div><div class="st300_paragraph">The <span class="st300_term package">com.io7m.jtensors</span> package provides square <span class="st300_term term">computation</span> matrices with single-precision <span class="st300_term type">(float)</span> elements, and double-precision <span class="st300_term type">(double)</span> elements. Each matrix type is available in 2x2, 3x3, and 4x4 versions. The package unambiguously identifies the matrix types by using the following naming conventions for the types (given as a simple EBNF grammar) :</div></div><div class="st300_formal_item"><a id="conventions.matrices.naming"/><div class="st300_formal_item_title"><a id="st300_p2s2ss1c2" href="#st300_p2s2ss1c2" title="Formal item 2.2.1.2: Matrix type naming">2.2.1.2 Matrix type naming</a></div><div class="st300_formal_item_content"><pre class="st300_verbatim">prefix       = "Matrix" | "PMatrix"
size         = "2x2" | "3x3" | "4x4" ;
element_type = "F" | "D" ;
type         = prefix , size , element_type ;</pre></div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss1c3" href="#st300_p2s2ss1c3" title="Paragraph 2.2.1.3">3</a></div><div class="st300_paragraph">Computation matrices are always immutable and are defined in such a way to allow the Java virtual machine to efficiently inline all matrix method calls and to eliminate the allocations of intermediate matrices via <span class="st300_term term">escape analysis</span>.</div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss1c4" href="#st300_p2s2ss1c4" title="Paragraph 2.2.1.4">4</a></div><div class="st300_paragraph">The available matrix types include:</div></div><div class="st300_formal_item"><a id="conventions.matrices.available"/><div class="st300_formal_item_title"><a id="st300_p2s2ss1c5" href="#st300_p2s2ss1c5" title="Formal item 2.2.1.5: Matrix types">2.2.1.5 Matrix types</a></div><div class="st300_formal_item_content"><ul class="st300_list_unordered"><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/unparameterized/matrices/Matrix2D.html">Matrix2x2D</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/unparameterized/matrices/Matrix3D.html">Matrix3x3D</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/unparameterized/matrices/Matrix4D.html">Matrix4x4D</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/unparameterized/matrices/Matrix2F.html">Matrix2x2F</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/unparameterized/matrices/Matrix3F.html">Matrix3x3F</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/unparameterized/matrices/Matrix4F.html">Matrix4x4F</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/parameterized/matrices/PMatrix2D.html">PMatrix2x2D</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/parameterized/matrices/PMatrix3D.html">PMatrix3x3D</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/parameterized/matrices/PMatrix4D.html">PMatrix4x4D</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/parameterized/matrices/PMatrix2F.html">PMatrix2x2F</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/parameterized/matrices/PMatrix3F.html">PMatrix3x3F</a></li><li class="st300_list_item"><a class="st300_link_external" href="apidocs/com/io7m/jtensors/core/parameterized/matrices/PMatrix4F.html">PMatrix4x4F</a></li></ul></div></div></div><div class="st300_subsection_container"><a id="conventions.matrices.storage_types"/><div class="st300_subsection_title_number"><a id="st300_p2s2ss2" href="#st300_p2s2ss2" title="Subsection 2.2.2: Storage Types">2.2.2</a></div><div class="st300_subsection_title">Storage Types</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss2c1" href="#st300_p2s2ss2c1" title="Paragraph 2.2.2.1">1</a></div><div class="st300_paragraph">The <span class="st300_term package">com.io7m.jtensors</span> package provides mutable <span class="st300_term term">storage</span> matrices. A <span class="st300_term term">storage</span> matrix is a mutable matrix upon which only very simple <span class="st300_term term">get</span> and <span class="st300_term term">set</span> operations are defined. The intention is to allow all intermediate computations to be written with immutable <a class="st300_link" href="p2s2.xhtml#conventions.matrices.computation_types">computation</a> matrices, with the final results of those computations being written to storage matrices in order to, for example, be passed directly to native code without requiring copying.</div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss2c2" href="#st300_p2s2ss2c2" title="Paragraph 2.2.2.2">2</a></div><div class="st300_paragraph">To enumerate the available storage matrix types, see the API documentation for the <a class="st300_link_external" href="apidocs/com/io7m/jtensors/storage/api/MatrixStorageType.html">MatrixStorageType</a> interface.</div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss2c3" href="#st300_p2s2ss2c3" title="Paragraph 2.2.2.3">3</a></div><div class="st300_paragraph">Matrix data is stored in column-major format <span class="st300_footnote_reference">[<a href="p2s2.xhtml#st300_f_1391_0" id="st300_fr_956" title="Jump to footnote conventions.matrices.column_major (reference 0)">2</a>]</span>, in whatever is the platform's native byte order. For an <span class="st300_term expression">m x m</span> square matrix, assuming that each element of the matrix uses <span class="st300_term expression">n</span> bytes, the first byte of the element at row <span class="st300_term expression">r</span> and column <span class="st300_term expression">c</span> (assuming <span class="st300_term expression">0 &lt;= r &lt; m</span> and <span class="st300_term expression">0 &lt;= c &lt; m</span>) can be found by <span class="st300_term expression">(c * m * n) + (r * n)</span>.</div></div><div class="st300_formal_item"><div class="st300_formal_item_title"><a id="st300_p2s2ss2c4" href="#st300_p2s2ss2c4" title="Formal item 2.2.2.4: Column-major storage memory layout">2.2.2.4 Column-major storage memory layout</a></div><div class="st300_formal_item_content"><img class="st300_image" alt="Column-major storage memory layout" src="images/memory.png"/></div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss2c5" href="#st300_p2s2ss2c5" title="Paragraph 2.2.2.5">5</a></div><div class="st300_paragraph">So, the element at row <span class="st300_term constant">0</span>, column <span class="st300_term constant">0</span> would be stored in bytes <span class="st300_term expression">[0 .. 3]</span>. The element at row <span class="st300_term constant">1</span>, column <span class="st300_term constant">0</span> would be stored in bytes <span class="st300_term expression">[4 .. 7]</span>. The element at row <span class="st300_term constant">0</span>, column <span class="st300_term constant">1</span> would be stored in bytes <span class="st300_term expression">[16 .. 19]</span>, and so on.</div></div></div><div class="st300_subsection_container"><a id="conventions.matrices.phantom"/><div class="st300_subsection_title_number"><a id="st300_p2s2ss3" href="#st300_p2s2ss3" title="Subsection 2.2.3: Phantom Types">2.2.3</a></div><div class="st300_subsection_title">Phantom Types</div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss3c1" href="#st300_p2s2ss3c1" title="Paragraph 2.2.3.1">1</a></div><div class="st300_paragraph">As with the vector types, the <span class="st300_term package">com.io7m.jtensors</span> package provides copies of all of the existing matrix types indexed by a pair of <span class="st300_term term">phantom type parameters</span>.</div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss3c2" href="#st300_p2s2ss3c2" title="Paragraph 2.2.3.2">2</a></div><div class="st300_paragraph">Conceptually, a matrix can be considered as storing a transform from coordinate space <span class="st300_term expression">T0</span> to space <span class="st300_term expression">T1</span>. For a 4x4 matrix in the <span class="st300_term package">com.io7m.jtensors</span> package, this is denoted by the type <span class="st300_term expression">PMatrix4x4D&lt;T0,T1&gt;</span>. It then follows that when matrices are concatenated via multiplications, their type parameters are translated accordingly. For example, a matrix <span class="st300_term expression">PMatrix4x4D&lt;T0,T1&gt;</span> multiplied by a matrix <span class="st300_term expression">PMatrix4x4D&lt;T1,T2&gt;</span> results in a matrix of type <span class="st300_term expression">PMatrix4x4D&lt;T0,T2&gt;</span>. Inverting a matrix results in a matrix that represents the inverse of the original transform that the matrix represented. For example, inverting a matrix of type <span class="st300_term expression">PMatrix4x4D&lt;T0,T1&gt;</span> results in a matrix of type <span class="st300_term expression">PMatrix4x4D&lt;T1,T0&gt;</span>.</div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss3c3" href="#st300_p2s2ss3c3" title="Paragraph 2.2.3.3">3</a></div><div class="st300_paragraph">Type parameters are also translated across multiplications by vectors. A multiplication of a vector of type <span class="st300_term expression">PVector4D&lt;T0&gt;</span> by a matrix of type <span class="st300_term expression">PMatrix4x4D&lt;T0,T1&gt;</span> results in a vector of type <span class="st300_term expression">PVector4D&lt;T1&gt;</span>.</div></div><div class="st300_paragraph_container"><div class="st300_paragraph_number"><a id="st300_p2s2ss3c4" href="#st300_p2s2ss3c4" title="Paragraph 2.2.3.4">4</a></div><div class="st300_paragraph">Being able to track the types of transforms at this level of detail is invaluable when using systems such as OpenGL, where accidentally mixing up matrices tends to result in visual anomalies that can be extremely hard to track down. By explicitly denoting coordinate spaces with empty types, it's possible to statically prevent all bugs involving accidentally mixing up matrices. It's also possible to prevent the incorrect construction of matrices <span class="st300_footnote_reference">[<a href="p2s2.xhtml#st300_f_1405_0" id="st300_fr_1365" title="Jump to footnote conventions.matrices.phantom.incorrect (reference 0)">3</a>]</span>. Additionally, with each matrix labelled by the type of transform it represents, code becomes self-documenting.</div></div><div class="st300_formal_item"><div class="st300_formal_item_title"><a id="st300_p2s2ss3c5" href="#st300_p2s2ss3c5" title="Formal item 2.2.3.5: Static tracking of transforms">2.2.3.5 Static tracking of transforms</a></div><div class="st300_formal_item_content"><pre class="st300_verbatim">interface WorldSpace { }
interface ViewSpace { }
interface ObjectSpace { }

PMatrix4x4D&lt;ObjectSpace, WorldSpace&gt; matrix_model;
PMatrix4x4D&lt;WorldSpace, ViewSpace&gt; matrix_view;
PMatrix4x4D&lt;ObjectSpace, ViewSpace&gt; matrix_modelview;

// Correct!
matrix_modelview = PMatrices4x4D.multiply (matrix_view, matrix_model);

// Correct!
Optional&lt;PMatrix4x4D&lt;ViewSpace, WorldSpace&gt;&gt; matrix_view_inverse =
  PMatrices4x4D.invert(matrix_view);

// Compilation error: The resulting matrix would be of type PMatrix4x4D&lt;ViewSpace, ObjectSpace&gt;
// matrix_modelview = PMatrices4x4D.multiply (matrix_model, matrix_view);
</pre></div></div></div><div class="st300_footnotes"><hr/><div class="st300_footnote_container"><div class="st300_footnote_id">[<a id="st300_f_1391_0" href="p2s2.xhtml#st300_fr_956" title="Jump back to reference 0 of footnote conventions.matrices.column_major">2</a>]</div><div class="st300_footnote_body">The convention used by most programs using the <a class="st300_link_external" href="http://opengl.org">OpenGL</a> API.</div></div><div class="st300_footnote_container"><div class="st300_footnote_id">[<a id="st300_f_1405_0" href="p2s2.xhtml#st300_fr_1365" title="Jump back to reference 0 of footnote conventions.matrices.phantom.incorrect">3</a>]</div><div class="st300_footnote_body">It is common for people to make mistakes with matrix multiplication: The order of matrices is effectively the reverse of the order in which the transforms will be applied.</div></div></div></div><div class="st300_navbar st300_navbar_bottom"><hr class="st300_hr"/><table class="st300_navbar_table" summary="st300_Navigation bar"><tr><td class="st300_navbar_prev_file_cell"><a rel="previous" href="p2s1.xhtml#st300_p2s1" title="Go to previous page">Previous</a></td><td class="st300_navbar_up_file_cell"><a rel="up" href="p2.xhtml#st300_p2" title="Go to parent page">Up</a></td><td class="st300_navbar_next_file_cell"><a rel="next" href="p2s3.xhtml#st300_p2s3" title="Go to next page">Next</a></td></tr><tr><td class="st300_navbar_prev_title_cell">2.1. Vectors</td><td class="st300_navbar_up_title_cell">2. Conventions</td><td class="st300_navbar_next_title_cell">2.3. Quaternions</td></tr></table></div></div></body></html>
